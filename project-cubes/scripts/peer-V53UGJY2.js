//! Copyright (c) 2015 Michelle Bu and Eric Zhang, http://peerjs.com, licensed under the MIT License
(()=>{(function(){function Q(e){return e&&e.__esModule?e.default:e}function b(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var Se,Fe,Ue;function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ze(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ge(e,t){return function(n){if(Array.isArray(n))return n}(e)||function(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}(e)||function(n,r){if(n){if(typeof n=="string")return ze(n,r);var i=Object.prototype.toString.call(n).slice(8,-1);return i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set"?Array.from(i):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ze(n,r):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Te(e){return e&&e.constructor===Symbol?"symbol":typeof e}var ee={};ee.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),ee.useArrayBufferView=!ee.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),Fe=ee;var Ve=Ue;function fe(){this._pieces=[],this._parts=[]}typeof window<"u"&&(Ve=Ue=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),fe.prototype.append=function(e){typeof e=="number"?this._pieces.push(e):(this.flush(),this._parts.push(e))},fe.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);ee.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},fe.prototype.getBuffer=function(){if(this.flush(),ee.useBlobBuilder){for(var e=new Ve,t=0,n=this._parts.length;t<n;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)};var Et=fe,Je=Fe;function D(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function O(){this.bufferBuilder=new Et}function xt(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}Se={unpack:function(e){return new D(e).unpack()},pack:function(e){var t=new O;return t.pack(e),t.getBuffer()}},D.prototype.unpack=function(){var e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},D.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},D.prototype.unpack_uint16=function(){var e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t},D.prototype.unpack_uint32=function(){var e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t},D.prototype.unpack_uint64=function(){var e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t},D.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},D.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},D.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},D.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},D.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},D.prototype.unpack_string=function(e){for(var t,n,r=this.read(e),i=0,s="";i<e;)(t=r[i])<128?(s+=String.fromCharCode(t),i++):(192^t)<32?(n=(192^t)<<6|63&r[i+1],s+=String.fromCharCode(n),i+=2):(n=(15&t)<<12|(63&r[i+1])<<6|63&r[i+2],s+=String.fromCharCode(n),i+=3);return this.index+=e,s},D.prototype.unpack_array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this.unpack();return t},D.prototype.unpack_map=function(e){for(var t={},n=0;n<e;n++){var r=this.unpack(),i=this.unpack();t[r]=i}return t},D.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=(e>>23&255)-127;return(e>>31?-1:1)*(8388607&e|8388608)*Math.pow(2,t-23)},D.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),n=(e>>20&2047)-1023;return(e>>31?-1:1)*((1048575&e|1048576)*Math.pow(2,n-20)+t*Math.pow(2,n-52))},D.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},O.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},O.prototype.pack=function(e){var t=e===void 0?"undefined":Te(e);if(t==="string")this.pack_string(e);else if(t==="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(t==="boolean")e===!0?this.bufferBuilder.append(195):e===!1&&this.bufferBuilder.append(194);else if(t==="undefined")this.bufferBuilder.append(192);else{if(t!=="object")throw new Error('Type "'+t+'" not yet supported');if(e===null)this.bufferBuilder.append(192);else{var n=e.constructor;if(n==Array)this.pack_array(e);else if(n==Blob||n==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(n==ArrayBuffer)Je.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)Je.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(n==Object||n.toString().startsWith("class"))this.pack_object(e);else if(n==Date)this.pack_string(e.toString());else{if(typeof e.toBinaryPack!="function")throw new Error('Type "'+n.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},O.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},O.prototype.pack_string=function(e){var t=function(n){return n.length>600?new Blob([n]).size:n.replace(/[^\u0000-\u007F]/g,xt).length}(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},O.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var n=0;n<t;n++)this.pack(e[n])},O.prototype.pack_integer=function(e){if(e>=-32&&e<=127)this.bufferBuilder.append(255&e);else if(e>=0&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(e>=0&&e<=18446744073709552e3))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},O.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var n=Math.floor(Math.log(e)/Math.LN2),r=e/Math.pow(2,n)-1,i=Math.floor(r*Math.pow(2,52)),s=Math.pow(2,32),o=t<<31|n+1023<<20|i/s&1048575,a=i%s;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)},O.prototype.pack_object=function(e){var t=Object.keys(e).length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(t)}for(var n in e)e.hasOwnProperty(n)&&(this.pack(n),this.pack(e[n]))},O.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},O.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},O.prototype.pack_uint32=function(e){var t=4294967295&e;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},O.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)},O.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},O.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},O.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},O.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)};var We=!0,He=!0;function ie(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function te(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==t)return i.apply(this,arguments);var p=function(c){var u=n(c);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(a,p),i.apply(this,[o,p])};var s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(a))return s.apply(this,arguments);var p=this._eventMap[t].get(a);return this._eventMap[t].delete(a),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,p])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}}function Dt(e){return typeof e!="boolean"?new Error("Argument type: "+(e===void 0?"undefined":Te(e))+". Please use a boolean."):(We=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Ot(e){return typeof e!="boolean"?new Error("Argument type: "+(e===void 0?"undefined":Te(e))+". Please use a boolean."):(He=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function ke(){if(typeof window=="object"){if(We)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function he(e,t){He&&console.warn(e+" is deprecated, please use "+t+" instead.")}function It(e){var t={browser:null,version:null};if(e===void 0||!e.navigator)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=ie(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=ie(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=ie(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=ie(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function Ke(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ye(e){return Ke(e)?Object.keys(e).reduce(function(t,n){var r=Ke(e[n]),i=r?Ye(e[n]):e[n],s=r&&!Object.keys(i).length;return i===void 0||s?t:Object.assign(t,le({},n,i))},{}):e}function we(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(function(r){r.endsWith("Id")?we(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(function(i){we(e,e.get(i),n)})}))}function qe(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;var s=[];return e.forEach(function(o){o.type==="track"&&o.trackIdentifier===t.id&&s.push(o)}),s.forEach(function(o){e.forEach(function(a){a.type===r&&a.trackId===o.id&&we(e,a,i)})}),i}var w={};b(w,"shimMediaStream",function(){return At}),b(w,"shimOnTrack",function(){return Lt}),b(w,"shimGetSendersWithDtmf",function(){return Bt}),b(w,"shimGetStats",function(){return Nt}),b(w,"shimSenderReceiverGetStats",function(){return Ft}),b(w,"shimAddTrackRemoveTrackWithNative",function(){return Xe}),b(w,"shimAddTrackRemoveTrack",function(){return Ut}),b(w,"shimPeerConnection",function(){return zt}),b(w,"fixNegotiationNeeded",function(){return Gt}),b(w,"shimGetUserMedia",function(){return Mt}),b(w,"shimGetDisplayMedia",function(){return jt});var Qe=ke;function Mt(e,t){var n=e&&e.navigator;if(n.mediaDevices){var r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;var p={};return Object.keys(a).forEach(function(c){if(c!=="require"&&c!=="advanced"&&c!=="mediaSource"){var u=typeof a[c]=="object"?a[c]:{ideal:a[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);var d=function(h,y){return h?h+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(u.ideal!==void 0){p.optional=p.optional||[];var l={};typeof u.ideal=="number"?(l[d("min",c)]=u.ideal,p.optional.push(l),(l={})[d("max",c)]=u.ideal,p.optional.push(l)):(l[d("",c)]=u.ideal,p.optional.push(l))}u.exact!==void 0&&typeof u.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[d("",c)]=u.exact):["min","max"].forEach(function(h){u[h]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[d(h,c)]=u[h])})}}),a.advanced&&(p.optional=(p.optional||[]).concat(a.advanced)),p},i=function(a,p){if(t.version>=61)return p(a);if((a=JSON.parse(JSON.stringify(a)))&&typeof a.audio=="object"){var c=function(h,y,m){y in h&&!(m in h)&&(h[m]=h[y],delete h[y])};c((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){var u=a.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});var d,l=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||l)&&(delete a.video.facingMode,u.exact==="environment"||u.ideal==="environment"?d=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(d=["front"]),d))return n.mediaDevices.enumerateDevices().then(function(h){var y=(h=h.filter(function(m){return m.kind==="videoinput"})).find(function(m){return d.some(function(g){return m.label.toLowerCase().includes(g)})});return!y&&h.length&&d.includes("back")&&(y=h[h.length-1]),y&&(a.video.deviceId=u.exact?{exact:y.deviceId}:{ideal:y.deviceId}),a.video=r(a.video),Qe("chrome: "+JSON.stringify(a)),p(a)});a.video=r(a.video)}return Qe("chrome: "+JSON.stringify(a)),p(a)},s=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(a,p,c){i(a,function(u){n.webkitGetUserMedia(u,p,function(d){c&&c(s(d))})})}.bind(n),n.mediaDevices.getUserMedia){var o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(a){return i(a,function(p){return o(p).then(function(c){if(p.audio&&!c.getAudioTracks().length||p.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(function(u){u.stop()}),new DOMException("","NotFoundError");return c},function(c){return Promise.reject(s(c))})})}}}}function jt(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(function(r){var i=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function At(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Lt(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(!this._ontrackpoly){var n=this;this._ontrackpoly=function(r){var i=n;r.stream.addEventListener("addtrack",function(s){var o;o=e.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(p){return p.track&&p.track.id===s.track.id}):{track:s.track};var a=new Event("track");a.track=s.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[r.stream],i.dispatchEvent(a)}),r.stream.getTracks().forEach(function(s){var o;o=e.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(p){return p.track&&p.track.id===s.id}):{track:s};var a=new Event("track");a.track=s,a.receiver=o,a.transceiver={receiver:o},a.streams=[r.stream],i.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)}return t.apply(this,arguments)}}else te(e,"track",function(n){return n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n})}function Bt(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(a,p){return{track:p,get dtmf(){return this._dtmf===void 0&&(p.kind==="audio"?this._dtmf=a.createDTMFSender(p):this._dtmf=null),this._dtmf},_pc:a}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,p){var c=n.apply(this,arguments);return c||(c=t(this,a),this._senders.push(c)),c};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);var p=this._senders.indexOf(a);p!==-1&&this._senders.splice(p,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){var p=this;this._senders=this._senders||[],i.apply(this,[a]),a.getTracks().forEach(function(c){p._senders.push(t(p,c))})};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){var p=this;this._senders=this._senders||[],s.apply(this,[a]),a.getTracks().forEach(function(c){var u=p._senders.find(function(d){return d.track===c});u&&p._senders.splice(p._senders.indexOf(u),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var a=this,p=o.apply(this,[]);return p.forEach(function(c){return c._pc=a}),p},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Nt(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var n=this,r=Ge(arguments,3),i=r[0],s=r[1],o=r[2];if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);var a=function(u){var d={};return u.result().forEach(function(l){var h={id:l.id,timestamp:l.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type};l.names().forEach(function(y){h[y]=l.stat(y)}),d[h.id]=h}),d},p=function(u){return new Map(Object.keys(u).map(function(d){return[d,u[d]]}))};if(arguments.length>=2){var c=function(u){s(p(a(u)))};return t.apply(this,[c,i])}return new Promise(function(u,d){t.apply(n,[function(l){u(p(a(l)))},d])}).then(s,o)}}}function Ft(e){if(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var s=this,o=t.apply(this,[]);return o.forEach(function(a){return a._pc=s}),o});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var s=n.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){var s=this;return this._pc.getStats().then(function(o){return qe(o,s.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var s=this,o=r.apply(this,[]);return o.forEach(function(a){return a._pc=s}),o}),te(e,"track",function(s){return s.receiver._pc=s.srcElement,s}),e.RTCRtpReceiver.prototype.getStats=function(){var s=this;return this._pc.getStats().then(function(o){return qe(o,s.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var s,o,a,p=arguments[0];return this.getSenders().forEach(function(c){c.track===p&&(s?a=!0:s=c)}),this.getReceivers().forEach(function(c){return c.track===p&&(o?a=!0:o=c),c.track===p}),a||s&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function Xe(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var s=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(o){return s._shimmedLocalStreams[o][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var a=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(a)===-1&&this._shimmedLocalStreams[o.id].push(a):this._shimmedLocalStreams[o.id]=[o,a],a};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){var o=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(function(c){if(o.getSenders().find(function(u){return u.track===c}))throw new DOMException("Track already exists.","InvalidAccessError")});var a=this.getSenders();n.apply(this,arguments);var p=this.getSenders().filter(function(c){return a.indexOf(c)===-1});this._shimmedLocalStreams[s.id]=[s].concat(p)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){var o=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(function(a){var p=o._shimmedLocalStreams[a].indexOf(s);p!==-1&&o._shimmedLocalStreams[a].splice(p,1),o._shimmedLocalStreams[a].length===1&&delete o._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function Ut(e,t){var n=function(c,u){var d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(function(l){var h=c._reverseStreams[l],y=c._streams[h.id];d=d.replace(new RegExp(y.id,"g"),h.id)}),new RTCSessionDescription({type:u.type,sdp:d})},r=function(c,u){var d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(function(l){var h=c._reverseStreams[l],y=c._streams[h.id];d=d.replace(new RegExp(h.id,"g"),y.id)}),new RTCSessionDescription({type:u.type,sdp:d})};if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Xe(e);var i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var c=this,u=i.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(function(d){return c._reverseStreams[d.id]})};var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){var u=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(function(l){if(u.getSenders().find(function(h){return h.track===l}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){var d=new e.MediaStream(c.getTracks());this._streams[c.id]=d,this._reverseStreams[d.id]=c,c=d}s.apply(this,[c])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},e.RTCPeerConnection.prototype.addTrack=function(c,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(function(g){return g===c}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var l=this.getSenders().find(function(g){return g.track===c});if(l)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var h=this._streams[u.id];if(h){var y=this;h.addTrack(c),Promise.resolve().then(function(){y.dispatchEvent(new Event("negotiationneeded"))})}else{var m=new e.MediaStream([c]);this._streams[u.id]=m,this._reverseStreams[m.id]=u,this.addStream(m)}return this.getSenders().find(function(g){return g.track===c})},["createOffer","createAnswer"].forEach(function(c){var u=e.RTCPeerConnection.prototype[c],d=le({},c,function(){var l=this,h=arguments,y=arguments.length&&typeof arguments[0]=="function";return y?u.apply(this,[function(m){var g=n(l,m);h[0].apply(null,[g])},function(m){h[1]&&h[1].apply(null,m)},arguments[2]]):u.apply(this,arguments).then(function(m){return n(l,m)})});e.RTCPeerConnection.prototype[c]=d[c]});var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=r(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var c=p.get.apply(this);return c.type===""?c:n(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(c){var u,d=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(function(l){d._streams[l].getTracks().find(function(h){return c.track===h})&&(u=d._streams[l])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function zt(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){var r=e.RTCPeerConnection.prototype[n],i=le({},n,function(){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[n]=i[n]})}function Gt(e,t){te(e,"negotiationneeded",function(n){var r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var z={};b(z,"shimPeerConnection",function(){return Wt}),b(z,"shimReplaceTrack",function(){return Ht}),b(z,"shimGetUserMedia",function(){return Vt}),b(z,"shimGetDisplayMedia",function(){return Jt});var Ze,C={},f={};function $e(e,t,n,r,i){var s=C.writeRtpDescription(e.kind,t);if(s+=C.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=C.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":i||"active"),s+="a=mid:"+e.mid+`\r
`,e.rtpSender&&e.rtpReceiver?s+=`a=sendrecv\r
`:e.rtpSender?s+=`a=sendonly\r
`:e.rtpReceiver?s+=`a=recvonly\r
`:s+=`a=inactive\r
`,e.rtpSender){var o=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=o;var a="msid:"+(r?r.id:"-")+" "+o+`\r
`;s+="a="+a,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+C.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+C.localCName+`\r
`),s}function me(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(s,o){s=parseInt(s,10);for(var a=0;a<o.length;a++)if(o[a].payloadType===s||o[a].preferredPayloadType===s)return o[a]},i=function(s,o,a,p){var c=r(s.parameters.apt,a),u=r(o.parameters.apt,p);return c&&u&&c.name.toLowerCase()===u.name.toLowerCase()};return e.codecs.forEach(function(s){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(s.name.toLowerCase()===a.name.toLowerCase()&&s.clockRate===a.clockRate){if(s.name.toLowerCase()==="rtx"&&s.parameters&&a.parameters.apt&&!i(s,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(s.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(p){for(var c=0;c<s.rtcpFeedback.length;c++)if(s.rtcpFeedback[c].type===p.type&&s.rtcpFeedback[c].parameter===p.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(s){for(var o=0;o<t.headerExtensions.length;o++){var a=t.headerExtensions[o];if(s.uri===a.uri){n.headerExtensions.push(a);break}}}),n}function et(e,t,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)!==-1}function Pe(e,t){var n=e.getRemoteCandidates().find(function(r){return t.foundation===r.foundation&&t.ip===r.ip&&t.port===r.port&&t.priority===r.priority&&t.protocol===r.protocol&&t.type===r.type});return n||e.addRemoteCandidate(t),!n}function M(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}function Vt(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(r){return n(r).catch(function(i){return Promise.reject(function(s){return{name:{PermissionDeniedError:"NotAllowedError"}[s.name]||s.name,message:s.message,constraint:s.constraint,toString:function(){return this.name}}}(i))})}}function Jt(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function Wt(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(i){return i}),e.RTCSessionDescription||(e.RTCSessionDescription=function(i){return i}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(i){n.set.call(this,i);var s=new Event("enabled");s.enabled=i,this.dispatchEvent(s)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=Q(Ze)(e,t.version);e.RTCPeerConnection=function(i){var s,o;return i&&i.iceServers&&(i.iceServers=(s=i.iceServers,t.version,o=!1,(s=JSON.parse(JSON.stringify(s))).filter(function(a){if(a&&(a.urls||a.url)){var p=a.urls||a.url;a.url&&!a.urls&&he("RTCIceServer.url","RTCIceServer.urls");var c=typeof p=="string";return c&&(p=[p]),p=p.filter(function(u){if(u.indexOf("stun:")===0)return!1;var d=u.startsWith("turn")&&!u.startsWith("turn:[")&&u.includes("transport=udp");return d&&!o?(o=!0,!0):d&&!o}),delete a.url,a.urls=c?p[0]:p,!!p.length}})),ke("ICE servers after filtering:",i.iceServers)),new r(i)},e.RTCPeerConnection.prototype=r.prototype}function Ht(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}f.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},f.localCName=f.generateIdentifier(),f.splitLines=function(e){return e.trim().split(`
`).map(function(t){return t.trim()})},f.splitSections=function(e){return e.split(`
m=`).map(function(t,n){return(n>0?"m="+t:t).trim()+`\r
`})},f.getDescription=function(e){var t=f.splitSections(e);return t&&t[0]},f.getMediaSections=function(e){var t=f.splitSections(e);return t.shift(),t},f.matchPrefix=function(e,t){return f.splitLines(e).filter(function(n){return n.indexOf(t)===0})},f.parseCandidate=function(e){for(var t,n={foundation:(t=e.indexOf("a=candidate:")===0?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},f.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),n!=="host"&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},f.parseIceOptions=function(e){return e.substr(14).split(" ")},f.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=t.length===3?parseInt(t[2],10):1,n.numChannels=n.channels,n},f.writeRtpMap=function(e){var t=e.payloadType;e.preferredPayloadType!==void 0&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(n!==1?"/"+n:"")+`\r
`},f.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},f.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+`\r
`},f.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},f.writeFmtp=function(e){var t="",n=e.payloadType;if(e.preferredPayloadType!==void 0&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(i){e.parameters[i]?r.push(i+"="+e.parameters[i]):r.push(i)}),t+="a=fmtp:"+n+" "+r.join(";")+`\r
`}return t},f.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},f.writeRtcpFb=function(e){var t="",n=e.payloadType;return e.preferredPayloadType!==void 0&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(r){t+="a=rtcp-fb:"+n+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),t},f.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},f.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(n){return parseInt(n,10)})}},f.getMid=function(e){var t=f.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},f.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},f.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:f.matchPrefix(e+t,"a=fingerprint:").map(f.parseFingerprint)}},f.writeDtlsParameters=function(e,t){var n="a=setup:"+t+`\r
`;return e.fingerprints.forEach(function(r){n+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),n},f.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},f.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?f.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},f.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},f.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},f.getCryptoParameters=function(e,t){return f.matchPrefix(e+t,"a=crypto:").map(f.parseCryptoLine)},f.getIceParameters=function(e,t){var n=f.matchPrefix(e+t,"a=ice-ufrag:")[0],r=f.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substr(12),password:r.substr(10)}:null},f.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`},f.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=f.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var i=n[r],s=f.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){var o=f.parseRtpMap(s),a=f.matchPrefix(e,"a=fmtp:"+i+" ");switch(o.parameters=a.length?f.parseFmtp(a[0]):{},o.rtcpFeedback=f.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(f.parseRtcpFb),t.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(o.name.toUpperCase())}}}return f.matchPrefix(e,"a=extmap:").forEach(function(p){t.headerExtensions.push(f.parseExtmap(p))}),t},f.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(i){return i.preferredPayloadType!==void 0?i.preferredPayloadType:i.payloadType}).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,t.codecs.forEach(function(i){n+=f.writeRtpMap(i),n+=f.writeFmtp(i),n+=f.writeRtcpFb(i)});var r=0;return t.codecs.forEach(function(i){i.maxptime>r&&(r=i.maxptime)}),r>0&&(n+="a=maxptime:"+r+`\r
`),n+=`a=rtcp-mux\r
`,t.headerExtensions&&t.headerExtensions.forEach(function(i){n+=f.writeExtmap(i)}),n},f.parseRtpEncodingParameters=function(e){var t,n=[],r=f.parseRtpParameters(e),i=r.fecMechanisms.indexOf("RED")!==-1,s=r.fecMechanisms.indexOf("ULPFEC")!==-1,o=f.matchPrefix(e,"a=ssrc:").map(function(u){return f.parseSsrcMedia(u)}).filter(function(u){return u.attribute==="cname"}),a=o.length>0&&o[0].ssrc,p=f.matchPrefix(e,"a=ssrc-group:FID").map(function(u){return u.substr(17).split(" ").map(function(d){return parseInt(d,10)})});p.length>0&&p[0].length>1&&p[0][0]===a&&(t=p[0][1]),r.codecs.forEach(function(u){if(u.name.toUpperCase()==="RTX"&&u.parameters.apt){var d={ssrc:a,codecPayloadType:parseInt(u.parameters.apt,10)};a&&t&&(d.rtx={ssrc:t}),n.push(d),i&&((d=JSON.parse(JSON.stringify(d))).fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},n.push(d))}}),n.length===0&&a&&n.push({ssrc:a});var c=f.matchPrefix(e,"b=");return c.length&&(c=c[0].indexOf("b=TIAS:")===0?parseInt(c[0].substr(7),10):c[0].indexOf("b=AS:")===0?950*parseInt(c[0].substr(5),10)-16e3:void 0,n.forEach(function(u){u.maxBitrate=c})),n},f.parseRtcpParameters=function(e){var t={},n=f.matchPrefix(e,"a=ssrc:").map(function(s){return f.parseSsrcMedia(s)}).filter(function(s){return s.attribute==="cname"})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=f.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=r.length===0;var i=f.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},f.parseMsid=function(e){var t,n=f.matchPrefix(e,"a=msid:");if(n.length===1)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var r=f.matchPrefix(e,"a=ssrc:").map(function(i){return f.parseSsrcMedia(i)}).filter(function(i){return i.attribute==="msid"});return r.length>0?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0},f.parseSctpDescription=function(e){var t,n=f.parseMLine(e),r=f.matchPrefix(e,"a=max-message-size:");r.length>0&&(t=parseInt(r[0].substr(19),10)),isNaN(t)&&(t=65536);var i=f.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(f.matchPrefix(e,"a=sctpmap:").length>0){var s=f.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:t}}},f.writeSctpDescription=function(e,t){var n=[];return n=e.protocol!=="DTLS/SCTP"?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+t.port+`\r
`]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+t.port+" "+t.protocol+` 65535\r
`],t.maxMessageSize!==void 0&&n.push("a=max-message-size:"+t.maxMessageSize+`\r
`),n.join("")},f.generateSessionId=function(){return Math.random().toString().substr(2,21)},f.writeSessionBoilerplate=function(e,t,n){var r=t!==void 0?t:2;return`v=0\r
o=`+(n||"thisisadapterortc")+" "+(e||f.generateSessionId())+" "+r+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},f.writeMediaSection=function(e,t,n,r){var i=f.writeRtpDescription(e.kind,t);if(i+=f.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=f.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":"active"),i+="a=mid:"+e.mid+`\r
`,e.direction?i+="a="+e.direction+`\r
`:e.rtpSender&&e.rtpReceiver?i+=`a=sendrecv\r
`:e.rtpSender?i+=`a=sendonly\r
`:e.rtpReceiver?i+=`a=recvonly\r
`:i+=`a=inactive\r
`,e.rtpSender){var s="msid:"+r.id+" "+e.rtpSender.track.id+`\r
`;i+="a="+s,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+f.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+f.localCName+`\r
`),i},f.getDirection=function(e,t){for(var n=f.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?f.getDirection(t):"sendrecv"},f.getKind=function(e){return f.splitLines(e)[0].split(" ")[0].substr(2)},f.isRejected=function(e){return e.split(" ",2)[1]==="0"},f.parseMLine=function(e){var t=f.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},f.parseOLine=function(e){var t=f.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},f.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;for(var t=f.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||t[n].charAt(1)!=="=")return!1;return!0},C=f,Ze=function(e,t){var n=function(o,a){a.addTrack(o),a.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:o}))},r=function(o,a,p,c){var u=new Event("track");u.track=a,u.receiver=p,u.transceiver={receiver:p},u.streams=c,e.setTimeout(function(){o._dispatchEvent("track",u)})},i=function(o){var a=this,p=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(u){a[u]=p[u].bind(p)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",o=JSON.parse(JSON.stringify(o||{})),this.usingBundle=o.bundlePolicy==="max-bundle",o.rtcpMuxPolicy==="negotiate")throw M("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(o.rtcpMuxPolicy||(o.rtcpMuxPolicy="require"),o.iceTransportPolicy){case"all":case"relay":break;default:o.iceTransportPolicy="all"}switch(o.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:o.bundlePolicy="balanced"}if(o.iceServers=function(u,d){var l=!1;return(u=JSON.parse(JSON.stringify(u))).filter(function(h){if(h&&(h.urls||h.url)){var y=h.urls||h.url;h.url&&!h.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var m=typeof y=="string";return m&&(y=[y]),y=y.filter(function(g){return g.indexOf("turn:")!==0||g.indexOf("transport=udp")===-1||g.indexOf("turn:[")!==-1||l?g.indexOf("stun:")===0&&d>=14393&&g.indexOf("?transport=udp")===-1:(l=!0,!0)}),delete h.url,h.urls=m?y[0]:y,!!y.length}})}(o.iceServers||[],t),this._iceGatherers=[],o.iceCandidatePoolSize)for(var c=o.iceCandidatePoolSize;c>0;c--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:o.iceServers,gatherPolicy:o.iceTransportPolicy}));else o.iceCandidatePoolSize=0;this._config=o,this.transceivers=[],this._sdpSessionId=C.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(i.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(i.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(o,a){this._isClosed||(this.dispatchEvent(a),typeof this["on"+o]=="function"&&this["on"+o](a))},i.prototype._emitGatheringStateChange=function(){var o=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",o)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(o,a){var p=this.transceivers.length>0,c={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:o,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&p)c.iceTransport=this.transceivers[0].iceTransport,c.dtlsTransport=this.transceivers[0].dtlsTransport;else{var u=this._createIceAndDtlsTransports();c.iceTransport=u.iceTransport,c.dtlsTransport=u.dtlsTransport}return a||this.transceivers.push(c),c},i.prototype.addTrack=function(o,a){if(this._isClosed)throw M("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var p;if(this.transceivers.find(function(u){return u.track===o}))throw M("InvalidAccessError","Track already exists.");for(var c=0;c<this.transceivers.length;c++)this.transceivers[c].track||this.transceivers[c].kind!==o.kind||(p=this.transceivers[c]);return p||(p=this._createTransceiver(o.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(a)===-1&&this.localStreams.push(a),p.track=o,p.stream=a,p.rtpSender=new e.RTCRtpSender(o,p.dtlsTransport),p.rtpSender},i.prototype.addStream=function(o){var a=this;if(t>=15025)o.getTracks().forEach(function(c){a.addTrack(c,o)});else{var p=o.clone();o.getTracks().forEach(function(c,u){var d=p.getTracks()[u];c.addEventListener("enabled",function(l){d.enabled=l.enabled})}),p.getTracks().forEach(function(c){a.addTrack(c,p)})}},i.prototype.removeTrack=function(o){if(this._isClosed)throw M("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(o instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var a=this.transceivers.find(function(c){return c.rtpSender===o});if(!a)throw M("InvalidAccessError","Sender was not created by this connection.");var p=a.stream;a.rtpSender.stop(),a.rtpSender=null,a.track=null,a.stream=null,this.transceivers.map(function(c){return c.stream}).indexOf(p)===-1&&this.localStreams.indexOf(p)>-1&&this.localStreams.splice(this.localStreams.indexOf(p),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(o){var a=this;o.getTracks().forEach(function(p){var c=a.getSenders().find(function(u){return u.track===p});c&&a.removeTrack(c)})},i.prototype.getSenders=function(){return this.transceivers.filter(function(o){return!!o.rtpSender}).map(function(o){return o.rtpSender})},i.prototype.getReceivers=function(){return this.transceivers.filter(function(o){return!!o.rtpReceiver}).map(function(o){return o.rtpReceiver})},i.prototype._createIceGatherer=function(o,a){var p=this;if(a&&o>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var c=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(c,"state",{value:"new",writable:!0}),this.transceivers[o].bufferedCandidateEvents=[],this.transceivers[o].bufferCandidates=function(u){var d=!u.candidate||Object.keys(u.candidate).length===0;c.state=d?"completed":"gathering",p.transceivers[o].bufferedCandidateEvents!==null&&p.transceivers[o].bufferedCandidateEvents.push(u)},c.addEventListener("localcandidate",this.transceivers[o].bufferCandidates),c},i.prototype._gather=function(o,a){var p=this,c=this.transceivers[a].iceGatherer;if(!c.onlocalcandidate){var u=this.transceivers[a].bufferedCandidateEvents;this.transceivers[a].bufferedCandidateEvents=null,c.removeEventListener("localcandidate",this.transceivers[a].bufferCandidates),c.onlocalcandidate=function(d){if(!(p.usingBundle&&a>0)){var l=new Event("icecandidate");l.candidate={sdpMid:o,sdpMLineIndex:a};var h=d.candidate,y=!h||Object.keys(h).length===0;if(y)c.state!=="new"&&c.state!=="gathering"||(c.state="completed");else{c.state==="new"&&(c.state="gathering"),h.component=1,h.ufrag=c.getLocalParameters().usernameFragment;var m=C.writeCandidate(h);l.candidate=Object.assign(l.candidate,C.parseCandidate(m)),l.candidate.candidate=m,l.candidate.toJSON=function(){return{candidate:l.candidate.candidate,sdpMid:l.candidate.sdpMid,sdpMLineIndex:l.candidate.sdpMLineIndex,usernameFragment:l.candidate.usernameFragment}}}var g=C.getMediaSections(p._localDescription.sdp);g[l.candidate.sdpMLineIndex]+=y?`a=end-of-candidates\r
`:"a="+l.candidate.candidate+`\r
`,p._localDescription.sdp=C.getDescription(p._localDescription.sdp)+g.join("");var N=p.transceivers.every(function(E){return E.iceGatherer&&E.iceGatherer.state==="completed"});p.iceGatheringState!=="gathering"&&(p.iceGatheringState="gathering",p._emitGatheringStateChange()),y||p._dispatchEvent("icecandidate",l),N&&(p._dispatchEvent("icecandidate",new Event("icecandidate")),p.iceGatheringState="complete",p._emitGatheringStateChange())}},e.setTimeout(function(){u.forEach(function(d){c.onlocalcandidate(d)})},0)}},i.prototype._createIceAndDtlsTransports=function(){var o=this,a=new e.RTCIceTransport(null);a.onicestatechange=function(){o._updateIceConnectionState(),o._updateConnectionState()};var p=new e.RTCDtlsTransport(a);return p.ondtlsstatechange=function(){o._updateConnectionState()},p.onerror=function(){Object.defineProperty(p,"state",{value:"failed",writable:!0}),o._updateConnectionState()},{iceTransport:a,dtlsTransport:p}},i.prototype._disposeIceAndDtlsTransports=function(o){var a=this.transceivers[o].iceGatherer;a&&(delete a.onlocalcandidate,delete this.transceivers[o].iceGatherer);var p=this.transceivers[o].iceTransport;p&&(delete p.onicestatechange,delete this.transceivers[o].iceTransport);var c=this.transceivers[o].dtlsTransport;c&&(delete c.ondtlsstatechange,delete c.onerror,delete this.transceivers[o].dtlsTransport)},i.prototype._transceive=function(o,a,p){var c=me(o.localCapabilities,o.remoteCapabilities);a&&o.rtpSender&&(c.encodings=o.sendEncodingParameters,c.rtcp={cname:C.localCName,compound:o.rtcpParameters.compound},o.recvEncodingParameters.length&&(c.rtcp.ssrc=o.recvEncodingParameters[0].ssrc),o.rtpSender.send(c)),p&&o.rtpReceiver&&c.codecs.length>0&&(o.kind==="video"&&o.recvEncodingParameters&&t<15019&&o.recvEncodingParameters.forEach(function(u){delete u.rtx}),o.recvEncodingParameters.length?c.encodings=o.recvEncodingParameters:c.encodings=[{}],c.rtcp={compound:o.rtcpParameters.compound},o.rtcpParameters.cname&&(c.rtcp.cname=o.rtcpParameters.cname),o.sendEncodingParameters.length&&(c.rtcp.ssrc=o.sendEncodingParameters[0].ssrc),o.rtpReceiver.receive(c))},i.prototype.setLocalDescription=function(o){var a,p,c=this;if(["offer","answer"].indexOf(o.type)===-1)return Promise.reject(M("TypeError",'Unsupported type "'+o.type+'"'));if(!et("setLocalDescription",o.type,c.signalingState)||c._isClosed)return Promise.reject(M("InvalidStateError","Can not set local "+o.type+" in state "+c.signalingState));if(o.type==="offer")a=C.splitSections(o.sdp),p=a.shift(),a.forEach(function(d,l){var h=C.parseRtpParameters(d);c.transceivers[l].localCapabilities=h}),c.transceivers.forEach(function(d,l){c._gather(d.mid,l)});else if(o.type==="answer"){a=C.splitSections(c._remoteDescription.sdp),p=a.shift();var u=C.matchPrefix(p,"a=ice-lite").length>0;a.forEach(function(d,l){var h=c.transceivers[l],y=h.iceGatherer,m=h.iceTransport,g=h.dtlsTransport,N=h.localCapabilities,E=h.remoteCapabilities;if(!(C.isRejected(d)&&C.matchPrefix(d,"a=bundle-only").length===0)&&!h.rejected){var P=C.getIceParameters(d,p),L=C.getDtlsParameters(d,p);u&&(L.role="server"),c.usingBundle&&l!==0||(c._gather(h.mid,l),m.state==="new"&&m.start(y,P,u?"controlling":"controlled"),g.state==="new"&&g.start(L));var V=me(N,E);c._transceive(h,V.codecs.length>0,!1)}})}return c._localDescription={type:o.type,sdp:o.sdp},o.type==="offer"?c._updateSignalingState("have-local-offer"):c._updateSignalingState("stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(o){var a=this;if(["offer","answer"].indexOf(o.type)===-1)return Promise.reject(M("TypeError",'Unsupported type "'+o.type+'"'));if(!et("setRemoteDescription",o.type,a.signalingState)||a._isClosed)return Promise.reject(M("InvalidStateError","Can not set remote "+o.type+" in state "+a.signalingState));var p={};a.remoteStreams.forEach(function(m){p[m.id]=m});var c=[],u=C.splitSections(o.sdp),d=u.shift(),l=C.matchPrefix(d,"a=ice-lite").length>0,h=C.matchPrefix(d,"a=group:BUNDLE ").length>0;a.usingBundle=h;var y=C.matchPrefix(d,"a=ice-options:")[0];return a.canTrickleIceCandidates=!!y&&y.substr(14).split(" ").indexOf("trickle")>=0,u.forEach(function(m,g){var N=C.splitLines(m),E=C.getKind(m),P=C.isRejected(m)&&C.matchPrefix(m,"a=bundle-only").length===0,L=N[0].substr(2).split(" ")[2],V=C.getDirection(m,d),F=C.parseMsid(m),Ct=C.getMid(m)||C.generateIdentifier();if(P||E==="application"&&(L==="DTLS/SCTP"||L==="UDP/DTLS/SCTP"))a.transceivers[g]={mid:Ct,kind:E,protocol:L,rejected:!0};else{var _,bt,ue,Ae,H,Le,Be,de,K;!P&&a.transceivers[g]&&a.transceivers[g].rejected&&(a.transceivers[g]=a._createTransceiver(E,!0));var _t,St,Tt=C.parseRtpParameters(m);P||(_t=C.getIceParameters(m,d),(St=C.getDtlsParameters(m,d)).role="client"),Be=C.parseRtpEncodingParameters(m);var kt=C.parseRtcpParameters(m),wt=C.matchPrefix(m,"a=end-of-candidates",d).length>0,ne=C.matchPrefix(m,"a=candidate:").map(function(U){return C.parseCandidate(U)}).filter(function(U){return U.component===1});if((o.type==="offer"||o.type==="answer")&&!P&&h&&g>0&&a.transceivers[g]&&(a._disposeIceAndDtlsTransports(g),a.transceivers[g].iceGatherer=a.transceivers[0].iceGatherer,a.transceivers[g].iceTransport=a.transceivers[0].iceTransport,a.transceivers[g].dtlsTransport=a.transceivers[0].dtlsTransport,a.transceivers[g].rtpSender&&a.transceivers[g].rtpSender.setTransport(a.transceivers[0].dtlsTransport),a.transceivers[g].rtpReceiver&&a.transceivers[g].rtpReceiver.setTransport(a.transceivers[0].dtlsTransport)),o.type!=="offer"||P)o.type==="answer"&&!P&&(bt=(_=a.transceivers[g]).iceGatherer,ue=_.iceTransport,Ae=_.dtlsTransport,H=_.rtpReceiver,Le=_.sendEncodingParameters,de=_.localCapabilities,a.transceivers[g].recvEncodingParameters=Be,a.transceivers[g].remoteCapabilities=Tt,a.transceivers[g].rtcpParameters=kt,ne.length&&ue.state==="new"&&(!l&&!wt||h&&g!==0?ne.forEach(function(U){Pe(_.iceTransport,U)}):ue.setRemoteCandidates(ne)),h&&g!==0||(ue.state==="new"&&ue.start(bt,_t,"controlling"),Ae.state==="new"&&Ae.start(St)),!me(_.localCapabilities,_.remoteCapabilities).codecs.filter(function(U){return U.name.toLowerCase()==="rtx"}).length&&_.sendEncodingParameters[0].rtx&&delete _.sendEncodingParameters[0].rtx,a._transceive(_,V==="sendrecv"||V==="recvonly",V==="sendrecv"||V==="sendonly"),!H||V!=="sendrecv"&&V!=="sendonly"?delete _.rtpReceiver:(K=H.track,F?(p[F.stream]||(p[F.stream]=new e.MediaStream),n(K,p[F.stream]),c.push([K,H,p[F.stream]])):(p.default||(p.default=new e.MediaStream),n(K,p.default),c.push([K,H,p.default]))));else{(_=a.transceivers[g]||a._createTransceiver(E)).mid=Ct,_.iceGatherer||(_.iceGatherer=a._createIceGatherer(g,h)),ne.length&&_.iceTransport.state==="new"&&(!wt||h&&g!==0?ne.forEach(function(U){Pe(_.iceTransport,U)}):_.iceTransport.setRemoteCandidates(ne)),de=e.RTCRtpReceiver.getCapabilities(E),t<15019&&(de.codecs=de.codecs.filter(function(U){return U.name!=="rtx"})),Le=_.sendEncodingParameters||[{ssrc:1001*(2*g+2)}];var re,Ne=!1;V==="sendrecv"||V==="sendonly"?(Ne=!_.rtpReceiver,H=_.rtpReceiver||new e.RTCRtpReceiver(_.dtlsTransport,E),Ne&&(K=H.track,F&&F.stream==="-"||(F?(p[F.stream]||(p[F.stream]=new e.MediaStream,Object.defineProperty(p[F.stream],"id",{get:function(){return F.stream}})),Object.defineProperty(K,"id",{get:function(){return F.track}}),re=p[F.stream]):(p.default||(p.default=new e.MediaStream),re=p.default)),re&&(n(K,re),_.associatedRemoteMediaStreams.push(re)),c.push([K,H,re]))):_.rtpReceiver&&_.rtpReceiver.track&&(_.associatedRemoteMediaStreams.forEach(function(U){var Pt=U.getTracks().find(function(_e){return _e.id===_.rtpReceiver.track.id});Pt&&function(_e,Rt){Rt.removeTrack(_e),Rt.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:_e}))}(Pt,U)}),_.associatedRemoteMediaStreams=[]),_.localCapabilities=de,_.remoteCapabilities=Tt,_.rtpReceiver=H,_.rtcpParameters=kt,_.sendEncodingParameters=Le,_.recvEncodingParameters=Be,a._transceive(a.transceivers[g],!1,Ne)}}}),a._dtlsRole===void 0&&(a._dtlsRole=o.type==="offer"?"active":"passive"),a._remoteDescription={type:o.type,sdp:o.sdp},o.type==="offer"?a._updateSignalingState("have-remote-offer"):a._updateSignalingState("stable"),Object.keys(p).forEach(function(m){var g=p[m];if(g.getTracks().length){if(a.remoteStreams.indexOf(g)===-1){a.remoteStreams.push(g);var N=new Event("addstream");N.stream=g,e.setTimeout(function(){a._dispatchEvent("addstream",N)})}c.forEach(function(E){var P=E[0],L=E[1];g.id===E[2].id&&r(a,P,L,[g])})}}),c.forEach(function(m){m[2]||r(a,m[0],m[1],[])}),e.setTimeout(function(){a&&a.transceivers&&a.transceivers.forEach(function(m){m.iceTransport&&m.iceTransport.state==="new"&&m.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),m.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach(function(o){o.iceTransport&&o.iceTransport.stop(),o.dtlsTransport&&o.dtlsTransport.stop(),o.rtpSender&&o.rtpSender.stop(),o.rtpReceiver&&o.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(o){this.signalingState=o;var a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)},i.prototype._maybeFireNegotiationNeeded=function(){var o=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,e.setTimeout(function(){if(o.needNegotiation){o.needNegotiation=!1;var a=new Event("negotiationneeded");o._dispatchEvent("negotiationneeded",a)}},0))},i.prototype._updateIceConnectionState=function(){var o,a={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(c){c.iceTransport&&!c.rejected&&a[c.iceTransport.state]++}),o="new",a.failed>0?o="failed":a.checking>0?o="checking":a.disconnected>0?o="disconnected":a.new>0?o="new":a.connected>0?o="connected":a.completed>0&&(o="completed"),o!==this.iceConnectionState){this.iceConnectionState=o;var p=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",p)}},i.prototype._updateConnectionState=function(){var o,a={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(c){c.iceTransport&&c.dtlsTransport&&!c.rejected&&(a[c.iceTransport.state]++,a[c.dtlsTransport.state]++)}),a.connected+=a.completed,o="new",a.failed>0?o="failed":a.connecting>0?o="connecting":a.disconnected>0?o="disconnected":a.new>0?o="new":a.connected>0&&(o="connected"),o!==this.connectionState){this.connectionState=o;var p=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",p)}},i.prototype.createOffer=function(){var o=this;if(o._isClosed)return Promise.reject(M("InvalidStateError","Can not call createOffer after close"));var a=o.transceivers.filter(function(l){return l.kind==="audio"}).length,p=o.transceivers.filter(function(l){return l.kind==="video"}).length,c=arguments[0];if(c){if(c.mandatory||c.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");c.offerToReceiveAudio!==void 0&&(a=c.offerToReceiveAudio===!0?1:c.offerToReceiveAudio===!1?0:c.offerToReceiveAudio),c.offerToReceiveVideo!==void 0&&(p=c.offerToReceiveVideo===!0?1:c.offerToReceiveVideo===!1?0:c.offerToReceiveVideo)}for(o.transceivers.forEach(function(l){l.kind==="audio"?--a<0&&(l.wantReceive=!1):l.kind==="video"&&--p<0&&(l.wantReceive=!1)});a>0||p>0;)a>0&&(o._createTransceiver("audio"),a--),p>0&&(o._createTransceiver("video"),p--);var u=C.writeSessionBoilerplate(o._sdpSessionId,o._sdpSessionVersion++);o.transceivers.forEach(function(l,h){var y=l.track,m=l.kind,g=l.mid||C.generateIdentifier();l.mid=g,l.iceGatherer||(l.iceGatherer=o._createIceGatherer(h,o.usingBundle));var N=e.RTCRtpSender.getCapabilities(m);t<15019&&(N.codecs=N.codecs.filter(function(P){return P.name!=="rtx"})),N.codecs.forEach(function(P){P.name==="H264"&&P.parameters["level-asymmetry-allowed"]===void 0&&(P.parameters["level-asymmetry-allowed"]="1"),l.remoteCapabilities&&l.remoteCapabilities.codecs&&l.remoteCapabilities.codecs.forEach(function(L){P.name.toLowerCase()===L.name.toLowerCase()&&P.clockRate===L.clockRate&&(P.preferredPayloadType=L.payloadType)})}),N.headerExtensions.forEach(function(P){(l.remoteCapabilities&&l.remoteCapabilities.headerExtensions||[]).forEach(function(L){P.uri===L.uri&&(P.id=L.id)})});var E=l.sendEncodingParameters||[{ssrc:1001*(2*h+1)}];y&&t>=15019&&m==="video"&&!E[0].rtx&&(E[0].rtx={ssrc:E[0].ssrc+1}),l.wantReceive&&(l.rtpReceiver=new e.RTCRtpReceiver(l.dtlsTransport,m)),l.localCapabilities=N,l.sendEncodingParameters=E}),o._config.bundlePolicy!=="max-compat"&&(u+="a=group:BUNDLE "+o.transceivers.map(function(l){return l.mid}).join(" ")+`\r
`),u+=`a=ice-options:trickle\r
`,o.transceivers.forEach(function(l,h){u+=$e(l,l.localCapabilities,"offer",l.stream,o._dtlsRole),u+=`a=rtcp-rsize\r
`,!l.iceGatherer||o.iceGatheringState==="new"||h!==0&&o.usingBundle||(l.iceGatherer.getLocalCandidates().forEach(function(y){y.component=1,u+="a="+C.writeCandidate(y)+`\r
`}),l.iceGatherer.state==="completed"&&(u+=`a=end-of-candidates\r
`))});var d=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(d)},i.prototype.createAnswer=function(){var o=this;if(o._isClosed)return Promise.reject(M("InvalidStateError","Can not call createAnswer after close"));if(o.signalingState!=="have-remote-offer"&&o.signalingState!=="have-local-pranswer")return Promise.reject(M("InvalidStateError","Can not call createAnswer in signalingState "+o.signalingState));var a=C.writeSessionBoilerplate(o._sdpSessionId,o._sdpSessionVersion++);o.usingBundle&&(a+="a=group:BUNDLE "+o.transceivers.map(function(u){return u.mid}).join(" ")+`\r
`),a+=`a=ice-options:trickle\r
`;var p=C.getMediaSections(o._remoteDescription.sdp).length;o.transceivers.forEach(function(u,d){if(!(d+1>p)){if(u.rejected)return u.kind==="application"?u.protocol==="DTLS/SCTP"?a+=`m=application 0 DTLS/SCTP 5000\r
`:a+="m=application 0 "+u.protocol+` webrtc-datachannel\r
`:u.kind==="audio"?a+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:u.kind==="video"&&(a+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(a+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+u.mid+`\r
`);var l;u.stream&&(u.kind==="audio"?l=u.stream.getAudioTracks()[0]:u.kind==="video"&&(l=u.stream.getVideoTracks()[0]),l&&t>=15019&&u.kind==="video"&&!u.sendEncodingParameters[0].rtx&&(u.sendEncodingParameters[0].rtx={ssrc:u.sendEncodingParameters[0].ssrc+1}));var h=me(u.localCapabilities,u.remoteCapabilities);!h.codecs.filter(function(y){return y.name.toLowerCase()==="rtx"}).length&&u.sendEncodingParameters[0].rtx&&delete u.sendEncodingParameters[0].rtx,a+=$e(u,h,"answer",u.stream,o._dtlsRole),u.rtcpParameters&&u.rtcpParameters.reducedSize&&(a+=`a=rtcp-rsize\r
`)}});var c=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(c)},i.prototype.addIceCandidate=function(o){var a,p=this;return o&&o.sdpMLineIndex===void 0&&!o.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(c,u){if(!p._remoteDescription)return u(M("InvalidStateError","Can not add ICE candidate without a remote description"));if(o&&o.candidate!==""){var d=o.sdpMLineIndex;if(o.sdpMid){for(var l=0;l<p.transceivers.length;l++)if(p.transceivers[l].mid===o.sdpMid){d=l;break}}var h=p.transceivers[d];if(!h)return u(M("OperationError","Can not add ICE candidate"));if(h.rejected)return c();var y=Object.keys(o.candidate).length>0?C.parseCandidate(o.candidate):{};if(y.protocol==="tcp"&&(y.port===0||y.port===9)||y.component&&y.component!==1)return c();if((d===0||d>0&&h.iceTransport!==p.transceivers[0].iceTransport)&&!Pe(h.iceTransport,y))return u(M("OperationError","Can not add ICE candidate"));var m=o.candidate.trim();m.indexOf("a=")===0&&(m=m.substr(2)),(a=C.getMediaSections(p._remoteDescription.sdp))[d]+="a="+(y.type?m:"end-of-candidates")+`\r
`,p._remoteDescription.sdp=C.getDescription(p._remoteDescription.sdp)+a.join("")}else for(var g=0;g<p.transceivers.length&&(p.transceivers[g].rejected||(p.transceivers[g].iceTransport.addRemoteCandidate({}),(a=C.getMediaSections(p._remoteDescription.sdp))[g]+=`a=end-of-candidates\r
`,p._remoteDescription.sdp=C.getDescription(p._remoteDescription.sdp)+a.join(""),!p.usingBundle));g++);c()})},i.prototype.getStats=function(o){if(o&&o instanceof e.MediaStreamTrack){var a=null;if(this.transceivers.forEach(function(c){c.rtpSender&&c.rtpSender.track===o?a=c.rtpSender:c.rtpReceiver&&c.rtpReceiver.track===o&&(a=c.rtpReceiver)}),!a)throw M("InvalidAccessError","Invalid selector.");return a.getStats()}var p=[];return this.transceivers.forEach(function(c){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(u){c[u]&&p.push(c[u].getStats())})}),Promise.all(p).then(function(c){var u=new Map;return c.forEach(function(d){d.forEach(function(l){u.set(l.id,l)})}),u})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(o){var a=e[o];if(a&&a.prototype&&a.prototype.getStats){var p=a.prototype.getStats;a.prototype.getStats=function(){return p.apply(this).then(function(c){var u=new Map;return Object.keys(c).forEach(function(d){var l;c[d].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(l=c[d]).type]||l.type,u.set(d,c[d])}),u})}}});var s=["createOffer","createAnswer"];return s.forEach(function(o){var a=i.prototype[o];i.prototype[o]=function(){var p=arguments;return typeof p[0]=="function"||typeof p[1]=="function"?a.apply(this,[arguments[2]]).then(function(c){typeof p[0]=="function"&&p[0].apply(null,[c])},function(c){typeof p[1]=="function"&&p[1].apply(null,[c])}):a.apply(this,arguments)}}),(s=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(o){var a=i.prototype[o];i.prototype[o]=function(){var p=arguments;return typeof p[1]=="function"||typeof p[2]=="function"?a.apply(this,arguments).then(function(){typeof p[1]=="function"&&p[1].apply(null)},function(c){typeof p[2]=="function"&&p[2].apply(null,[c])}):a.apply(this,arguments)}}),["getStats"].forEach(function(o){var a=i.prototype[o];i.prototype[o]=function(){var p=arguments;return typeof p[1]=="function"?a.apply(this,arguments).then(function(){typeof p[1]=="function"&&p[1].apply(null)}):a.apply(this,arguments)}}),i};var T={};function Kt(e,t){var n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(p,c,u){he("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(p).then(c,u)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var i=function(p,c,u){c in p&&!(u in p)&&(p[u]=p[c],delete p[c])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(p){return typeof p=="object"&&typeof p.audio=="object"&&(p=JSON.parse(JSON.stringify(p)),i(p.audio,"autoGainControl","mozAutoGainControl"),i(p.audio,"noiseSuppression","mozNoiseSuppression")),s(p)},r&&r.prototype.getSettings){var o=r.prototype.getSettings;r.prototype.getSettings=function(){var p=o.apply(this,arguments);return i(p,"mozAutoGainControl","autoGainControl"),i(p,"mozNoiseSuppression","noiseSuppression"),p}}if(r&&r.prototype.applyConstraints){var a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(JSON.stringify(p)),i(p,"autoGainControl","mozAutoGainControl"),i(p,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[p])}}}}function Yt(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function qt(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Qt(e,t){if(typeof e=="object"&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){var s=e.RTCPeerConnection.prototype[i],o=le({},i,function(){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)});e.RTCPeerConnection.prototype[i]=o[i]});var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var i=Ge(arguments,3),s=i[0],o=i[1],a=i[2];return r.apply(this,[s||null]).then(function(p){if(t.version<53&&!o)try{p.forEach(function(c){c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;p.forEach(function(u,d){p.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return p}).then(o,a)}}}function Xt(e){if(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var r=this,i=t.apply(this,[]);return i.forEach(function(s){return s._pc=r}),i});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function Zt(e){if(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var n=this,r=t.apply(this,[]);return r.forEach(function(i){return i._pc=n}),r}),te(e,"track",function(n){return n.receiver._pc=n.srcElement,n}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function $t(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){var n=this;he("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&t.getTracks().includes(r.track)&&n.removeTrack(r)})})}function en(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function tn(e){if(typeof e=="object"&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var n=arguments[1],r=n&&"sendEncodings"in n;r&&n.sendEncodings.forEach(function(a){if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var i=t.apply(this,arguments);if(r){var s=i.sender,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n.sendEncodings,s.sendEncodings=n.sendEncodings,this.setParametersPromises.push(s.setParameters(o).then(function(){delete s.sendEncodings}).catch(function(){delete s.sendEncodings})))}return i})}}function nn(e){if(typeof e=="object"&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}}function rn(e){if(typeof e=="object"&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var n=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(n,r)}).finally(function(){n.setParametersPromises=[]}):t.apply(this,arguments)}}}function on(e){if(typeof e=="object"&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var n=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(n,r)}).finally(function(){n.setParametersPromises=[]}):t.apply(this,arguments)}}}b(T,"shimOnTrack",function(){return qt}),b(T,"shimPeerConnection",function(){return Qt}),b(T,"shimSenderGetStats",function(){return Xt}),b(T,"shimReceiverGetStats",function(){return Zt}),b(T,"shimRemoveStream",function(){return $t}),b(T,"shimRTCDataChannel",function(){return en}),b(T,"shimAddTransceiver",function(){return tn}),b(T,"shimGetParameters",function(){return nn}),b(T,"shimCreateOffer",function(){return rn}),b(T,"shimCreateAnswer",function(){return on}),b(T,"shimGetUserMedia",function(){return Kt}),b(T,"shimGetDisplayMedia",function(){return Yt});var x={};function an(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(function(i){return t.call(r,i,n)}),n.getVideoTracks().forEach(function(i){return t.call(r,i,n)})},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o=this;return i&&i.forEach(function(a){o._localStreams?o._localStreams.includes(a)||o._localStreams.push(a):o._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){var r=this;this._localStreams||(this._localStreams=[]);var i=this._localStreams.indexOf(n);if(i!==-1){this._localStreams.splice(i,1);var s=n.getTracks();this.getSenders().forEach(function(o){s.includes(o.track)&&r.removeTrack(o)})}})}}function sn(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(n){var r=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=function(i){var s=r;i.streams.forEach(function(o){if(s._remoteStreams||(s._remoteStreams=[]),!s._remoteStreams.includes(o)){s._remoteStreams.push(o);var a=new Event("addstream");a.stream=o,s.dispatchEvent(a)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(function(i){if(n._remoteStreams||(n._remoteStreams=[]),!(n._remoteStreams.indexOf(i)>=0)){n._remoteStreams.push(i);var s=new Event("addstream");s.stream=i,n.dispatchEvent(s)}})}),t.apply(n,arguments)}}}function cn(e){if(typeof e=="object"&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(p,c){var u=arguments.length>=2?arguments[2]:arguments[0],d=n.apply(this,[u]);return c?(d.then(p,c),Promise.resolve()):d},t.createAnswer=function(p,c){var u=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[u]);return c?(d.then(p,c),Promise.resolve()):d};var a=function(p,c,u){var d=i.apply(this,[p]);return u?(d.then(c,u),Promise.resolve()):d};t.setLocalDescription=a,a=function(p,c,u){var d=s.apply(this,[p]);return u?(d.then(c,u),Promise.resolve()):d},t.setRemoteDescription=a,a=function(p,c,u){var d=o.apply(this,[p]);return u?(d.then(c,u),Promise.resolve()):d},t.addIceCandidate=a}}function pn(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(i){return r(tt(i))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(i,s,o){t.mediaDevices.getUserMedia(i).then(s,o)}.bind(t))}function tt(e){return e&&e.video!==void 0?Object.assign({},e,{video:Ye(e.video)}):e}function un(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){for(var i=[],s=0;s<n.iceServers.length;s++){var o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(he("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,i.push(o)):i.push(n.iceServers[s])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function dn(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function ln(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);var r=this.getTransceivers().find(function(s){return s.receiver.track.kind==="audio"});n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio"),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);var i=this.getTransceivers().find(function(s){return s.receiver.track.kind==="video"});n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video")}return t.apply(this,arguments)}}function fn(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}b(x,"shimLocalStreamsAPI",function(){return an}),b(x,"shimRemoteStreamsAPI",function(){return sn}),b(x,"shimCallbacksAPI",function(){return cn}),b(x,"shimGetUserMedia",function(){return pn}),b(x,"shimConstraints",function(){return tt}),b(x,"shimRTCIceServerUrls",function(){return un}),b(x,"shimTrackEventTransceiver",function(){return dn}),b(x,"shimCreateOfferLegacy",function(){return ln}),b(x,"shimAudioContext",function(){return fn});var k={};function hn(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){var r=new t(n),i=Q(C).parseCandidate(n.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,te(e,"icecandidate",function(n){return n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n})}}function mn(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var n=function(a){if(!a||!a.sdp)return!1;var p=Q(C).splitSections(a.sdp);return p.shift(),p.some(function(c){var u=Q(C).parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){var p=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;var c=parseInt(p[1],10);return c!=c?-1:c},i=function(a){var p=65536;return t.browser==="firefox"&&(p=t.version<57?a===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),p},s=function(a,p){var c=65536;t.browser==="firefox"&&t.version===57&&(c=65535);var u=Q(C).matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substr(19),10):t.browser==="firefox"&&p!==-1&&(c=2147483637),c},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){var a=this.getConfiguration().sdpSemantics;a==="plan-b"&&Object.defineProperty(this,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var p,c=r(arguments[0]),u=i(c),d=s(arguments[0],c);p=u===0&&d===0?Number.POSITIVE_INFINITY:u===0||d===0?Math.max(u,d):Math.min(u,d);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return p}}),this._sctp=l}return o.apply(this,arguments)}}}function vn(e){var t=function(r,i){var s=r.send;r.send=function(){var o=arguments[0],a=o.length||o.size||o.byteLength;if(r.readyState==="open"&&i.sctp&&a>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}};if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var r=n.apply(this,arguments);return t(r,this),r},te(e,"datachannel",function(r){return t(r.channel,r.target),r})}}function gn(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(n){var r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(i){var s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;var o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}}function yn(e,t){if(e.RTCPeerConnection&&!(t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){var i=r.sdp.split(`
`).filter(function(s){return s.trim()!=="a=extmap-allow-mixed"}).join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}}function Cn(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}b(k,"shimRTCIceCandidate",function(){return hn}),b(k,"shimMaxMessageSize",function(){return mn}),b(k,"shimSendThrowTypeError",function(){return vn}),b(k,"shimConnectionState",function(){return gn}),b(k,"removeExtmapAllowMixed",function(){return yn}),b(k,"shimAddIceCandidateNullOrEmpty",function(){return Cn});var X,Y,bn=function(){var e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).window,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},n=ke,r=It(e),i={browserDetails:r,commonShim:k,extractVersion:ie,disableLog:Dt,disableWarnings:Ot};switch(r.browser){case"chrome":if(!w||!w.shimPeerConnection||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=w,k.shimAddIceCandidateNullOrEmpty(e,r),w.shimGetUserMedia(e,r),w.shimMediaStream(e,r),w.shimPeerConnection(e,r),w.shimOnTrack(e,r),w.shimAddTrackRemoveTrack(e,r),w.shimGetSendersWithDtmf(e,r),w.shimGetStats(e,r),w.shimSenderReceiverGetStats(e,r),w.fixNegotiationNeeded(e,r),k.shimRTCIceCandidate(e,r),k.shimConnectionState(e,r),k.shimMaxMessageSize(e,r),k.shimSendThrowTypeError(e,r),k.removeExtmapAllowMixed(e,r);break;case"firefox":if(!T||!T.shimPeerConnection||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=T,k.shimAddIceCandidateNullOrEmpty(e,r),T.shimGetUserMedia(e,r),T.shimPeerConnection(e,r),T.shimOnTrack(e,r),T.shimRemoveStream(e,r),T.shimSenderGetStats(e,r),T.shimReceiverGetStats(e,r),T.shimRTCDataChannel(e,r),T.shimAddTransceiver(e,r),T.shimGetParameters(e,r),T.shimCreateOffer(e,r),T.shimCreateAnswer(e,r),k.shimRTCIceCandidate(e,r),k.shimConnectionState(e,r),k.shimMaxMessageSize(e,r),k.shimSendThrowTypeError(e,r);break;case"edge":if(!z||!z.shimPeerConnection||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),i;n("adapter.js shimming edge."),i.browserShim=z,z.shimGetUserMedia(e,r),z.shimGetDisplayMedia(e,r),z.shimPeerConnection(e,r),z.shimReplaceTrack(e,r),k.shimMaxMessageSize(e,r),k.shimSendThrowTypeError(e,r);break;case"safari":if(!x||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=x,k.shimAddIceCandidateNullOrEmpty(e,r),x.shimRTCIceServerUrls(e,r),x.shimCreateOfferLegacy(e,r),x.shimCallbacksAPI(e,r),x.shimLocalStreamsAPI(e,r),x.shimRemoteStreamsAPI(e,r),x.shimTrackEventTransceiver(e,r),x.shimGetUserMedia(e,r),x.shimAudioContext(e,r),k.shimRTCIceCandidate(e,r),k.shimMaxMessageSize(e,r),k.shimSendThrowTypeError(e,r),k.removeExtmapAllowMixed(e,r);break;default:n("Unsupported browser!")}return i}({window:typeof window>"u"?void 0:window}),nt=bn,Re=nt.default||nt,oe=new((X=function(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}).prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},X.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&(e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"&&!this.isIOS&&t>=this.minSafariVersion)},X.prototype.getBrowser=function(){return Re.browserDetails.browser},X.prototype.getVersion=function(){return Re.browserDetails.version||0},X.prototype.isUnifiedPlanSupported=function(){var e,t=this.getBrowser(),n=Re.browserDetails.version||0;if(t==="chrome"&&n<this.minChromeVersion)return!1;if(t==="firefox"&&n>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var r=!1;try{(e=new RTCPeerConnection).addTransceiver("audio"),r=!0}catch{}finally{e&&e.close()}return r},X.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},X),rt={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},S=new((Y=function(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=rt,this.browser=oe.getBrowser(),this.browserVersion=oe.getVersion(),this.supports=function(){var e,t={browser:oe.isBrowserSupported(),webRTC:oe.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{e=new RTCPeerConnection(rt),t.audioVideo=!0;var n=void 0;try{n=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!n.ordered;try{n.binaryType="blob",t.binaryBlob=!oe.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{e&&e.close()}return t}(),this.pack=Q(Se).pack,this.unpack=Q(Se).unpack,this._dataCount=1}).prototype.noop=function(){},Y.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},Y.prototype.chunk=function(e){for(var t=[],n=e.size,r=Math.ceil(n/S.chunkedMTU),i=0,s=0;s<n;){var o=Math.min(n,s+S.chunkedMTU),a=e.slice(s,o),p={__peerData:this._dataCount,n:i,data:a,total:r};t.push(p),s=o,i++}return this._dataCount++,t},Y.prototype.blobToArrayBuffer=function(e,t){var n=new FileReader;return n.onload=function(r){r.target&&t(r.target.result)},n.readAsArrayBuffer(e),n},Y.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer},Y.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},Y.prototype.isSecure=function(){return location.protocol==="https:"},Y),Ee={};b(Ee,"Peer",function(){return yt},function(e){return yt=e});var ae,_n=Object.prototype.hasOwnProperty,A="~";function se(){}function Sn(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function it(e,t,n,r,i){if(typeof n!="function")throw new TypeError("The listener must be a function");var s=new Sn(n,r||e,i),o=A?A+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],s]:e._events[o].push(s):(e._events[o]=s,e._eventsCount++),e}function ve(e,t){--e._eventsCount==0?e._events=new se:delete e._events[t]}function j(){this._events=new se,this._eventsCount=0}Object.create&&(se.prototype=Object.create(null),new se().__proto__||(A=!1)),j.prototype.eventNames=function(){var e,t,n=[];if(this._eventsCount===0)return n;for(t in e=this._events)_n.call(e,t)&&n.push(A?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},j.prototype.listeners=function(e){var t=A?A+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,s=new Array(i);r<i;r++)s[r]=n[r].fn;return s},j.prototype.listenerCount=function(e){var t=A?A+e:e,n=this._events[t];return n?n.fn?1:n.length:0},j.prototype.emit=function(e,t,n,r,i,s){var o=A?A+e:e;if(!this._events[o])return!1;var a,p,c=this._events[o],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,s),!0}for(p=1,a=new Array(u-1);p<u;p++)a[p-1]=arguments[p];c.fn.apply(c.context,a)}else{var d,l=c.length;for(p=0;p<l;p++)switch(c[p].once&&this.removeListener(e,c[p].fn,void 0,!0),u){case 1:c[p].fn.call(c[p].context);break;case 2:c[p].fn.call(c[p].context,t);break;case 3:c[p].fn.call(c[p].context,t,n);break;case 4:c[p].fn.call(c[p].context,t,n,r);break;default:if(!a)for(d=1,a=new Array(u-1);d<u;d++)a[d-1]=arguments[d];c[p].fn.apply(c[p].context,a)}}return!0},j.prototype.on=function(e,t,n){return it(this,e,t,n,!1)},j.prototype.once=function(e,t,n){return it(this,e,t,n,!0)},j.prototype.removeListener=function(e,t,n,r){var i=A?A+e:e;if(!this._events[i])return this;if(!t)return ve(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||ve(this,i);else{for(var o=0,a=[],p=s.length;o<p;o++)(s[o].fn!==t||r&&!s[o].once||n&&s[o].context!==n)&&a.push(s[o]);a.length?this._events[i]=a.length===1?a[0]:a:ve(this,i)}return this},j.prototype.removeAllListeners=function(e){var t;return e?(t=A?A+e:e,this._events[t]&&ve(this,t)):(this._events=new se,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=A,j.EventEmitter=j,ae=j;var v={};b(v,"LogLevel",function(){return B},function(e){return B=e}),b(v,"default",function(){return ot},function(e){return ot=e});var B,Z=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(t===void 0||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},$=function(e,t,n){if(n||arguments.length===2)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},Tn="PeerJS: ";(function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"})(B||(B={}));var q,G,R,J,W,I,kn=(q=function(){this._logLevel=B.Disabled},Object.defineProperty(q.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),q.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=B.All&&this._print.apply(this,$([B.All],Z(e),!1))},q.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=B.Warnings&&this._print.apply(this,$([B.Warnings],Z(e),!1))},q.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=B.Errors&&this._print.apply(this,$([B.Errors],Z(e),!1))},q.prototype.setLogFunction=function(e){this._print=e},q.prototype._print=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=$([Tn],Z(t),!1);for(var i in r)r[i]instanceof Error&&(r[i]="("+r[i].name+") "+r[i].message);e>=B.All?console.log.apply(console,$([],Z(r),!1)):e>=B.Warnings?console.warn.apply(console,$(["WARNING"],Z(r),!1)):e>=B.Errors&&console.error.apply(console,$(["ERROR"],Z(r),!1))},q),ot=new kn,at={};b(at,"Socket",function(){return st},function(e){return st=e}),function(e){e.Data="data",e.Media="media"}(G||(G={})),function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"}(R||(R={})),function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"}(J||(J={})),function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"}(W||(W={})),function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"}(I||(I={}));var xe;xe=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var De,wn=(De=function(e,t){return(De=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])})(e,t)},function(e,t){var n=function(){this.constructor=e};if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");De(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}),Pn=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(t===void 0||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},Rn=function(e,t,n){if(n||arguments.length===2)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},En=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},st=function(e){var t=function(n,r,i,s,o,a){a===void 0&&(a=5e3);var p=e.call(this)||this;p.pingInterval=a,p._disconnected=!0,p._messagesQueue=[];var c=n?"wss://":"ws://";return p._baseUrl=c+r+":"+i+s+"peerjs?key="+o,p};return wn(t,e),t.prototype.start=function(n,r){var i=this;this._id=n;var s="".concat(this._baseUrl,"&id=").concat(n,"&token=").concat(r);!this._socket&&this._disconnected&&(this._socket=new WebSocket(s+"&version="+xe.version),this._disconnected=!1,this._socket.onmessage=function(o){var a;try{a=JSON.parse(o.data),v.default.log("Server message received:",a)}catch{return void v.default.log("Invalid server message",o.data)}i.emit(W.Message,a)},this._socket.onclose=function(o){i._disconnected||(v.default.log("Socket closed.",o),i._cleanup(),i._disconnected=!0,i.emit(W.Disconnected))},this._socket.onopen=function(){i._disconnected||(i._sendQueuedMessages(),v.default.log("Socket open"),i._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var n=this;this._wsPingTimer=setTimeout(function(){n._sendHeartbeat()},this.pingInterval)},t.prototype._sendHeartbeat=function(){if(this._wsOpen()){var n=JSON.stringify({type:I.Heartbeat});this._socket.send(n),this._scheduleHeartbeat()}else v.default.log("Cannot send heartbeat, because socket closed")},t.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},t.prototype._sendQueuedMessages=function(){var n,r,i=Rn([],Pn(this._messagesQueue),!1);this._messagesQueue=[];try{for(var s=En(i),o=s.next();!o.done;o=s.next()){var a=o.value;this.send(a)}}catch(p){n={error:p}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},t.prototype.send=function(n){if(!this._disconnected)if(this._id)if(n.type){if(this._wsOpen()){var r=JSON.stringify(n);this._socket.send(r)}}else this.emit(W.Error,"Invalid message");else this._messagesQueue.push(n)},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(ae.EventEmitter),Oe={};b(Oe,"MediaConnection",function(){return ut},function(e){return ut=e});var Ie={};b(Ie,"Negotiator",function(){return ct},function(e){return ct=e});var ge=function(){return ge=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ge.apply(this,arguments)},ye=function(e,t,n,r){return new(n||(n=Promise))(function(i,s){var o=function(c){try{p(r.next(c))}catch(u){s(u)}},a=function(c){try{p(r.throw(c))}catch(u){s(u)}},p=function(c){var u;c.done?i(c.value):(u=c.value,u instanceof n?u:new n(function(d){d(u)})).then(o,a)};p((r=r.apply(e,t||[])).next())})},Ce=function(e,t){var n,r,i,s,o=function(c){return function(u){return a([c,u])}},a=function(c){if(n)throw new TypeError("Generator is already executing.");for(;p;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return p.label++,{value:c[1],done:!1};case 5:p.label++,r=c[1],c=[0];continue;case 7:c=p.ops.pop(),p.trys.pop();continue;default:if(i=p.trys,!((i=i.length>0&&i[i.length-1])||c[0]!==6&&c[0]!==2)){p=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){p.label=c[1];break}if(c[0]===6&&p.label<i[1]){p.label=i[1],i=c;break}if(i&&p.label<i[2]){p.label=i[2],p.ops.push(c);break}i[2]&&p.ops.pop(),p.trys.pop();continue}c=t.call(e,p)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}},p={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s},ct=function(){var e=function(t){this.connection=t};return e.prototype.startConnection=function(t){var n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===G.Media&&t._stream&&this._addTracksToConnection(t._stream,n),t.originator){if(this.connection.type===G.Data){var r=this.connection,i={ordered:!!t.reliable},s=n.createDataChannel(r.label,i);r.initialize(s)}this._makeOffer()}else this.handleSDP("OFFER",t.sdp)},e.prototype._startPeerConnection=function(){v.default.log("Creating RTCPeerConnection.");var t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t},e.prototype._setupListeners=function(t){var n=this,r=this.connection.peer,i=this.connection.connectionId,s=this.connection.type,o=this.connection.provider;v.default.log("Listening for ICE candidates."),t.onicecandidate=function(a){a.candidate&&a.candidate.candidate&&(v.default.log("Received ICE candidates for ".concat(r,":"),a.candidate),o.socket.send({type:I.Candidate,payload:{candidate:a.candidate,type:s,connectionId:i},dst:r}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":v.default.log("iceConnectionState is failed, closing connections to "+r),n.connection.emit("error",new Error("Negotiation of connection to "+r+" failed.")),n.connection.close();break;case"closed":v.default.log("iceConnectionState is closed, closing connections to "+r),n.connection.emit("error",new Error("Connection to "+r+" closed.")),n.connection.close();break;case"disconnected":v.default.log("iceConnectionState changed to disconnected on the connection with "+r);break;case"completed":t.onicecandidate=S.noop}n.connection.emit("iceStateChanged",t.iceConnectionState)},v.default.log("Listening for data channel"),t.ondatachannel=function(a){v.default.log("Received data channel");var p=a.channel;o.getConnection(r,i).initialize(p)},v.default.log("Listening for remote stream"),t.ontrack=function(a){v.default.log("Received remote stream");var p=a.streams[0],c=o.getConnection(r,i);if(c.type===G.Media){var u=c;n._addStreamToMediaConnection(p,u)}}},e.prototype.cleanup=function(){v.default.log("Cleaning up PeerConnection to "+this.connection.peer);var t=this.connection.peerConnection;if(t){this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=function(){};var n=t.signalingState!=="closed",r=!1;if(this.connection.type===G.Data){var i=this.connection.dataChannel;i&&(r=!!i.readyState&&i.readyState!=="closed")}(n||r)&&t.close()}},e.prototype._makeOffer=function(){return ye(this,void 0,Promise,function(){var t,n,r,i,s,o,a;return Ce(this,function(p){switch(p.label){case 0:t=this.connection.peerConnection,n=this.connection.provider,p.label=1;case 1:return p.trys.push([1,7,,8]),[4,t.createOffer(this.connection.options.constraints)];case 2:r=p.sent(),v.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),p.label=3;case 3:return p.trys.push([3,5,,6]),[4,t.setLocalDescription(r)];case 4:return p.sent(),v.default.log("Set localDescription:",r,"for:".concat(this.connection.peer)),i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:S.browser},this.connection.type===G.Data&&(s=this.connection,i=ge(ge({},i),{label:s.label,reliable:s.reliable,serialization:s.serialization})),n.socket.send({type:I.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return(o=p.sent())!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(R.WebRTC,o),v.default.log("Failed to setLocalDescription, ",o)),[3,6];case 6:return[3,8];case 7:return a=p.sent(),n.emitError(R.WebRTC,a),v.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},e.prototype._makeAnswer=function(){return ye(this,void 0,Promise,function(){var t,n,r,i,s;return Ce(this,function(o){switch(o.label){case 0:t=this.connection.peerConnection,n=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:r=o.sent(),v.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,t.setLocalDescription(r)];case 4:return o.sent(),v.default.log("Set localDescription:",r,"for:".concat(this.connection.peer)),n.socket.send({type:I.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,browser:S.browser},dst:this.connection.peer}),[3,6];case 5:return i=o.sent(),n.emitError(R.WebRTC,i),v.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return s=o.sent(),n.emitError(R.WebRTC,s),v.default.log("Failed to create answer, ",s),[3,8];case 8:return[2]}})})},e.prototype.handleSDP=function(t,n){return ye(this,void 0,Promise,function(){var r,i,s,o;return Ce(this,function(a){switch(a.label){case 0:n=new RTCSessionDescription(n),r=this.connection.peerConnection,i=this.connection.provider,v.default.log("Setting remote description",n),s=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,r.setRemoteDescription(n)];case 2:return a.sent(),v.default.log("Set remoteDescription:".concat(t," for:").concat(this.connection.peer)),t!=="OFFER"?[3,4]:[4,s._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return o=a.sent(),i.emitError(R.WebRTC,o),v.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}})})},e.prototype.handleCandidate=function(t){return ye(this,void 0,Promise,function(){var n,r,i,s,o,a;return Ce(this,function(p){switch(p.label){case 0:v.default.log("handleCandidate:",t),n=t.candidate,r=t.sdpMLineIndex,i=t.sdpMid,s=this.connection.peerConnection,o=this.connection.provider,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,s.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:r,candidate:n}))];case 2:return p.sent(),v.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=p.sent(),o.emitError(R.WebRTC,a),v.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},e.prototype._addTracksToConnection=function(t,n){if(v.default.log("add tracks from stream ".concat(t.id," to peer connection")),!n.addTrack)return v.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(function(r){n.addTrack(r,t)})},e.prototype._addStreamToMediaConnection=function(t,n){v.default.log("add stream ".concat(t.id," to media connection ").concat(n.connectionId)),n.addStream(t)},e}(),Me={};b(Me,"BaseConnection",function(){return pt},function(e){return pt=e});var xn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])})(t,n)};return function(t,n){var r=function(){this.constructor=t};if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),pt=function(e){var t=function(n,r,i){var s=e.call(this)||this;return s.peer=n,s.provider=r,s.options=i,s._open=!1,s.metadata=i.metadata,s};return xn(t,e),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(ae.EventEmitter),Dn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])})(t,n)};return function(t,n){var r=function(){this.constructor=t};if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),be=function(){return be=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},be.apply(this,arguments)},On=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ut=function(e){function t(n,r,i){var s=e.call(this,n,r,i)||this;return s._localStream=s.options._stream,s.connectionId=s.options.connectionId||t.ID_PREFIX+S.randomToken(),s._negotiator=new Ie.Negotiator(s),s._localStream&&s._negotiator.startConnection({_stream:s._localStream,originator:!0}),s}return Dn(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return G.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(n){v.default.log("Receiving stream",n),this._remoteStream=n,e.prototype.emit.call(this,"stream",n)},t.prototype.handleMessage=function(n){var r=n.type,i=n.payload;switch(n.type){case I.Answer:this._negotiator.handleSDP(r,i.sdp),this._open=!0;break;case I.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:v.default.warn("Unrecognized message type:".concat(r," from peer:").concat(this.peer))}},t.prototype.answer=function(n,r){var i,s;if(r===void 0&&(r={}),this._localStream)v.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=n,r&&r.sdpTransform&&(this.options.sdpTransform=r.sdpTransform),this._negotiator.startConnection(be(be({},this.options._payload),{_stream:n}));var o=this.provider._getMessages(this.connectionId);try{for(var a=On(o),p=a.next();!p.done;p=a.next()){var c=p.value;this.handleMessage(c)}}catch(u){i={error:u}}finally{try{p&&!p.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}this._open=!0}},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},t.ID_PREFIX="mc_",t}(Me.BaseConnection),je={};b(je,"DataConnection",function(){return ft},function(e){return ft=e});var dt={};b(dt,"EncodingQueue",function(){return lt},function(e){return lt=e});var In=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])})(t,n)};return function(t,n){var r=function(){this.constructor=t};if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),lt=function(e){var t=function(){var n=e.call(this)||this;return n.fileReader=new FileReader,n._queue=[],n._processing=!1,n.fileReader.onload=function(r){n._processing=!1,r.target&&n.emit("done",r.target.result),n.doNextTask()},n.fileReader.onerror=function(r){v.default.error("EncodingQueue error:",r),n._processing=!1,n.destroy(),n.emit("error",r)},n};return In(t,e),Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(n){this.queue.push(n),this.processing||this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(ae.EventEmitter),Mn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])})(t,n)};return function(t,n){var r=function(){this.constructor=t};if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),jn=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ft=function(e){function t(n,r,i){var s=e.call(this,n,r,i)||this;return s.stringify=JSON.stringify,s.parse=JSON.parse,s._buffer=[],s._bufferSize=0,s._buffering=!1,s._chunkedData={},s._encodingQueue=new dt.EncodingQueue,s.connectionId=s.options.connectionId||t.ID_PREFIX+S.randomToken(),s.label=s.options.label||s.connectionId,s.serialization=s.options.serialization||J.Binary,s.reliable=!!s.options.reliable,s._encodingQueue.on("done",function(o){s._bufferedSend(o)}),s._encodingQueue.on("error",function(){v.default.error("DC#".concat(s.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),s.close()}),s._negotiator=new Ie.Negotiator(s),s._negotiator.startConnection(s.options._payload||{originator:!0}),s}return Mn(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return G.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(n){this._dc=n,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var n=this;S.supports.binaryBlob&&!S.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){v.default.log("DC#".concat(n.connectionId," dc connection success")),n._open=!0,n.emit("open")},this.dataChannel.onmessage=function(r){v.default.log("DC#".concat(n.connectionId," dc onmessage:"),r.data),n._handleDataMessage(r)},this.dataChannel.onclose=function(){v.default.log("DC#".concat(n.connectionId," dc closed for:"),n.peer),n.close()}},t.prototype._handleDataMessage=function(n){var r=this,i=n.data,s=i.constructor,o=i;if(this.serialization===J.Binary||this.serialization===J.BinaryUTF8){if(s===Blob)return void S.blobToArrayBuffer(i,function(p){var c=S.unpack(p);r.emit("data",c)});if(s===ArrayBuffer)o=S.unpack(i);else if(s===String){var a=S.binaryStringToArrayBuffer(i);o=S.unpack(a)}}else this.serialization===J.JSON&&(o=this.parse(i));o.__peerData?this._handleChunk(o):e.prototype.emit.call(this,"data",o)},t.prototype._handleChunk=function(n){var r=n.__peerData,i=this._chunkedData[r]||{data:[],count:0,total:n.total};if(i.data[n.n]=n.data,i.count++,this._chunkedData[r]=i,i.total===i.count){delete this._chunkedData[r];var s=new Blob(i.data);this._handleDataMessage({data:s})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},t.prototype.send=function(n,r){if(this.open)if(this.serialization===J.JSON)this._bufferedSend(this.stringify(n));else if(this.serialization===J.Binary||this.serialization===J.BinaryUTF8){var i=S.pack(n);if(!r&&i.size>S.chunkedMTU)return void this._sendChunks(i);S.supports.binaryBlob?this._bufferedSend(i):this._encodingQueue.enque(i)}else this._bufferedSend(n);else e.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},t.prototype._bufferedSend=function(n){!this._buffering&&this._trySend(n)||(this._buffer.push(n),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(n){var r=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){r._buffering=!1,r._tryBuffer()},50),!1;try{this.dataChannel.send(n)}catch(i){return v.default.error("DC#:".concat(this.connectionId," Error when sending:"),i),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var n=this._buffer[0];this._trySend(n)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(n){var r,i,s=S.chunk(n);v.default.log("DC#".concat(this.connectionId," Try to send ").concat(s.length," chunks..."));try{for(var o=jn(s),a=o.next();!a.done;a=o.next()){var p=a.value;this.send(p,!0)}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},t.prototype.handleMessage=function(n){var r=n.payload;switch(n.type){case I.Answer:this._negotiator.handleSDP(n.type,r.sdp);break;case I.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:v.default.warn("Unrecognized message type:",n.type,"from peer:",this.peer)}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(Me.BaseConnection),ht={};b(ht,"API",function(){return gt},function(e){return gt=e});var mt=function(e,t,n,r){return new(n||(n=Promise))(function(i,s){var o=function(c){try{p(r.next(c))}catch(u){s(u)}},a=function(c){try{p(r.throw(c))}catch(u){s(u)}},p=function(c){var u;c.done?i(c.value):(u=c.value,u instanceof n?u:new n(function(d){d(u)})).then(o,a)};p((r=r.apply(e,t||[])).next())})},vt=function(e,t){var n,r,i,s,o=function(c){return function(u){return a([c,u])}},a=function(c){if(n)throw new TypeError("Generator is already executing.");for(;p;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return p.label++,{value:c[1],done:!1};case 5:p.label++,r=c[1],c=[0];continue;case 7:c=p.ops.pop(),p.trys.pop();continue;default:if(i=p.trys,!((i=i.length>0&&i[i.length-1])||c[0]!==6&&c[0]!==2)){p=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){p.label=c[1];break}if(c[0]===6&&p.label<i[1]){p.label=i[1],i=c;break}if(i&&p.label<i[2]){p.label=i[2],p.ops.push(c);break}i[2]&&p.ops.pop(),p.trys.pop();continue}c=t.call(e,p)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}},p={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s},gt=function(){var e=function(t){this._options=t};return e.prototype._buildRequest=function(t){var n=this._options.secure?"https":"http",r=this._options,i=r.host,s=r.port,o=r.path,a=r.key,p=new URL("".concat(n,"://").concat(i,":").concat(s).concat(o).concat(a,"/").concat(t));return p.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),p.searchParams.set("version",xe.version),fetch(p.href,{referrerPolicy:this._options.referrerPolicy})},e.prototype.retrieveId=function(){return mt(this,void 0,Promise,function(){var t,n,r;return vt(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if((t=i.sent()).status!==200)throw new Error("Error. Status:".concat(t.status));return[2,t.text()];case 2:throw n=i.sent(),v.default.error("Error retrieving ID",n),r="",this._options.path==="/"&&this._options.host!==S.CLOUD_HOST&&(r=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+r);case 3:return[2]}})})},e.prototype.listAllPeers=function(){return mt(this,void 0,Promise,function(){var t,n,r;return vt(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if((t=i.sent()).status!==200)throw t.status===401?(n="",n=this._options.host===S.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)):new Error("Error. Status:".concat(t.status));return[2,t.json()];case 2:throw r=i.sent(),v.default.error("Error retrieving list peers",r),new Error("Could not get list peers from the server."+r);case 3:return[2]}})})},e}(),An=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])})(t,n)};return function(t,n){var r=function(){this.constructor=t};if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),ce=function(){return ce=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ce.apply(this,arguments)},pe=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ln=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(t===void 0||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},yt=function(e){function t(n,r){var i,s=e.call(this)||this;return s._id=null,s._lastServerId=null,s._destroyed=!1,s._disconnected=!1,s._open=!1,s._connections=new Map,s._lostMessages=new Map,n&&n.constructor==Object?r=n:n&&(i=n.toString()),r=ce({debug:0,host:S.CLOUD_HOST,port:S.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:S.randomToken(),config:S.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},r),s._options=r,s._options.host==="/"&&(s._options.host=window.location.hostname),s._options.path&&(s._options.path[0]!=="/"&&(s._options.path="/"+s._options.path),s._options.path[s._options.path.length-1]!=="/"&&(s._options.path+="/")),s._options.secure===void 0&&s._options.host!==S.CLOUD_HOST?s._options.secure=S.isSecure():s._options.host==S.CLOUD_HOST&&(s._options.secure=!0),s._options.logFunction&&v.default.setLogFunction(s._options.logFunction),v.default.logLevel=s._options.debug||0,s._api=new ht.API(r),s._socket=s._createServerConnection(),S.supports.audioVideo||S.supports.data?i&&!S.validateId(i)?(s._delayedAbort(R.InvalidID,'ID "'.concat(i,'" is invalid')),s):(i?s._initialize(i):s._api.retrieveId().then(function(o){return s._initialize(o)}).catch(function(o){return s._abort(R.ServerError,o)}),s):(s._delayedAbort(R.BrowserIncompatible,"The current browser does not support WebRTC"),s)}return An(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var n,r,i=Object.create(null);try{for(var s=pe(this._connections),o=s.next();!o.done;o=s.next()){var a=Ln(o.value,2),p=a[0],c=a[1];i[p]=c}}catch(u){n={error:u}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var n=this,r=new at.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return r.on(W.Message,function(i){n._handleMessage(i)}),r.on(W.Error,function(i){n._abort(R.SocketError,i)}),r.on(W.Disconnected,function(){n.disconnected||(n.emitError(R.Network,"Lost connection to server."),n.disconnect())}),r.on(W.Close,function(){n.disconnected||n._abort(R.SocketClosed,"Underlying socket is already closed.")}),r},t.prototype._initialize=function(n){this._id=n,this.socket.start(n,this._options.token)},t.prototype._handleMessage=function(n){var r,i,s=n.type,o=n.payload,a=n.src;switch(s){case I.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case I.Error:this._abort(R.ServerError,o.msg);break;case I.IdTaken:this._abort(R.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case I.InvalidKey:this._abort(R.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case I.Leave:v.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case I.Expire:this.emitError(R.PeerUnavailable,"Could not connect to peer ".concat(a));break;case I.Offer:var p=o.connectionId;if((m=this.getConnection(a,p))&&(m.close(),v.default.warn("Offer received for existing Connection ID:".concat(p))),o.type===G.Media){var c=new Oe.MediaConnection(a,this,{connectionId:p,_payload:o,metadata:o.metadata});m=c,this._addConnection(a,m),this.emit("call",c)}else{if(o.type!==G.Data)return void v.default.warn("Received malformed connection type:".concat(o.type));var u=new je.DataConnection(a,this,{connectionId:p,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});m=u,this._addConnection(a,m),this.emit("connection",u)}var d=this._getMessages(p);try{for(var l=pe(d),h=l.next();!h.done;h=l.next()){var y=h.value;m.handleMessage(y)}}catch(g){r={error:g}}finally{try{h&&!h.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}break;default:if(!o)return void v.default.warn("You received a malformed message from ".concat(a," of type ").concat(s));var m;p=o.connectionId,(m=this.getConnection(a,p))&&m.peerConnection?m.handleMessage(n):p?this._storeMessage(p,n):v.default.warn("You received an unrecognized message:",n)}},t.prototype._storeMessage=function(n,r){this._lostMessages.has(n)||this._lostMessages.set(n,[]),this._lostMessages.get(n).push(r)},t.prototype._getMessages=function(n){var r=this._lostMessages.get(n);return r?(this._lostMessages.delete(n),r):[]},t.prototype.connect=function(n,r){if(r===void 0&&(r={}),this.disconnected)return v.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(R.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var i=new je.DataConnection(n,this,r);return this._addConnection(n,i),i},t.prototype.call=function(n,r,i){if(i===void 0&&(i={}),this.disconnected)return v.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(R.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(r){var s=new Oe.MediaConnection(n,this,ce(ce({},i),{_stream:r}));return this._addConnection(n,s),s}v.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},t.prototype._addConnection=function(n,r){v.default.log("add connection ".concat(r.type,":").concat(r.connectionId," to peerId:").concat(n)),this._connections.has(n)||this._connections.set(n,[]),this._connections.get(n).push(r)},t.prototype._removeConnection=function(n){var r=this._connections.get(n.peer);if(r){var i=r.indexOf(n);i!==-1&&r.splice(i,1)}this._lostMessages.delete(n.connectionId)},t.prototype.getConnection=function(n,r){var i,s,o=this._connections.get(n);if(!o)return null;try{for(var a=pe(o),p=a.next();!p.done;p=a.next()){var c=p.value;if(c.connectionId===r)return c}}catch(u){i={error:u}}finally{try{p&&!p.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}return null},t.prototype._delayedAbort=function(n,r){var i=this;setTimeout(function(){i._abort(n,r)},0)},t.prototype._abort=function(n,r){v.default.error("Aborting!"),this.emitError(n,r),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(n,r){var i;v.default.error("Error:",r),(i=typeof r=="string"?new Error(r):r).type=n,this.emit("error",i)},t.prototype.destroy=function(){this.destroyed||(v.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},t.prototype._cleanup=function(){var n,r;try{for(var i=pe(this._connections.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(n){var r,i,s=this._connections.get(n);if(s)try{for(var o=pe(s),a=o.next();!a.done;a=o.next())a.value.close()}catch(p){r={error:p}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var n=this.id;v.default.log("Disconnect peer with ID:".concat(n)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=n,this._id=null,this.emit("disconnected",n)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)v.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"));v.default.error("In a hurry? We're still trying to make the initial connection!")}},t.prototype.listAllPeers=function(n){var r=this;n===void 0&&(n=function(i){}),this._api.listAllPeers().then(function(i){return n(i)}).catch(function(i){return r._abort(R.ServerError,i)})},t.DEFAULT_KEY="peerjs",t}(ae.EventEmitter);window.peerjs={Peer:Ee.Peer,util:S},window.Peer=Ee.Peer})();})();
