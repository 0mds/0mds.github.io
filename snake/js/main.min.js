const eN=t=>btoa(btoa(t)),dE=(t,e=null,r=!1)=>{try{let e=atob(atob(t));if(null===e||null===t)throw 0;if(r)try{JSON.parse(e)}catch(t){throw 1}return e}catch(t){return e}},canvas=document.getElementById("gBody"),ctx=canvas.getContext("2d"),dir={38:["-y","+y"],40:["+y","-y"],37:["+x","-x"],39:["-x","+x"]};canvas.tabIndex=1;const gSquare=15;var d,gWidth,gHeight,gCharacter,gLoop,gApple,gScoreSize,gScore=0,gColor="#444",gHighscore=localStorage.gHighscore?Number(dE(localStorage.gHighscore,0)):0;class Snake{constructor(){this.parts=[{x:gWidth/2-7.5,y:gHeight/2-7.5,direction:null,next:{x:gWidth/2-7.5,y:gHeight/2-7.5}}],this.turned=!1}draw(){for(let[t,e]of this.parts.entries())draw(e.x,e.y,15,15,0===t?"#222":gColor)}add(){gScore++,ctx.measureText(gScore).width>gWidth/1.2&&(console.log(1),gScoreSize/=2);for(let t=0;t<gScore;t++){let t=this.parts[this.parts.length-1];this.parts.push({x:t.x,y:t.y,next:{x:null,y:null}})}gScore>gHighscore&&(gHighscore=gScore,localStorage.gHighscore=btoa(btoa(gHighscore)),$("#gHighscore .inner").text(gHighscore))}collision(){let t=this.parts[0];if(gWidth<=t.x||t.x<=-15||gHeight<=t.y||t.y<=-15)return!0;if(t.x===gApple.x&&t.y===gApple.y)this.add(),apple();else for(let e=1;e<this.parts.length;e++)if(this.parts[e].x===t.x&&this.parts[e].y===t.y)return!0;return!1}turn(t){this.turned||gCharacter.parts[0].direction==t[0]||gCharacter.parts[0].direction==t[1]||(this.parts[0].direction=t[1],this.turned=!0)}move(){let t=this.parts[0];switch(t.direction){case"+x":t.next.x=t.x+15;break;case"+y":t.next.y=t.y-15;break;case"-x":t.next.x=t.x-15;break;case"-y":t.next.y=t.y+15}for(let t=0;t<this.parts.length;t++){let e=this.parts[t];this.parts[t+1]&&(this.parts[t+1].next={x:e.x,y:e.y}),e.next&&"number"==typeof e.next.x&&"number"==typeof e.next.y&&(e.x=e.next.x,e.y=e.next.y)}this.turned=!1}}const resize=()=>{d=[Math.floor(.7*window.innerWidth/15)-Math.floor(.7*window.innerWidth/15)%2-1,Math.floor(.8*window.innerHeight/15)-Math.floor(.8*window.innerHeight/15)%2-1],gWidth=15*d[0],gHeight=15*d[1],canvas.width=gWidth,canvas.height=gHeight},draw=(t,e,r,a,o=gColor)=>{ctx.fillStyle=o,ctx.beginPath(),ctx.arc(t+r/2,e+a/2,r/2,0,2*Math.PI,!1),ctx.fill()},clear=()=>{ctx.clearRect(0,0,gWidth,gHeight)},score=(t,e,r="#ddd")=>{ctx.fillStyle=r,ctx.font=e+"px Arial",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText(t,gWidth/2,gHeight/2)},tick=()=>{gCharacter.move(),gCharacter.collision()?(stop(),score("Game Over!",gWidth/6,"red"),setTimeout(start,500)):(clear(),score(gScore,gScoreSize),draw(gApple.x,gApple.y,15,15,"red"),gCharacter.draw())},apple=()=>{gApple={x:15*Math.floor(Math.random()*d[0]),y:15*Math.floor(Math.random()*d[1])};for(let t of gCharacter.parts)if(t.x===gApple.x&&t.y===gApple.y)return void apple()},start=()=>{stop(),$(canvas).on("keydown",(t=>([37,38,39,40].includes(t.keyCode)&&(t.preventDefault(),gCharacter.turn(dir[t.keyCode])),!1))),apple(),gLoop=setInterval(tick,80)},stop=()=>{clearInterval(gLoop),$(canvas).off(),clear(),gScore=0,gScoreSize=gHeight,gCharacter=new Snake};canvas.onfocus=start,canvas.onblur=()=>{stop(),score("Game Over!",gWidth/6,"red")},window.onresize=()=>{canvas.blur(),resize(),score("Game Over!",gWidth/6,"red")},resize(),score("Game Over!",gWidth/6,"red"),$("#gHighscore .inner").text(gHighscore);